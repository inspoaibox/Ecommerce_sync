# 快速诊断说明

## 🚨 问题现象

你说："怎么可能，明明是有映射的"

**分类映射页面显示**：
- ✅ Walmart分类: Sofas & Couches
- ✅ 包含 1 个本地分类 (共享映射ID: 144)
- ✅ Living room, bedroom, study, office sofa for home use
- ✅ ID: 17 | 商品数: 5695

**但诊断脚本显示**：
- ❌ 字段未在分类映射中配置

---

## 🔍 可能的原因

### **原因1: 浏览器缓存** 🔴

分类映射页面显示的可能是**缓存的旧数据**，而不是数据库中的实际数据。

**验证方法**：
```bash
php check-database-structure.php
```

这个脚本会直接查询数据库，显示实际存储的数据。

---

### **原因2: 保存失败** 🔴

点击「重置属性」后，可能：
- 没有点击「保存」按钮
- 保存时出现了 JavaScript 错误
- 数据库写入失败
- 网络请求失败

**验证方法**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 重新点击「重置属性」
4. 查看是否有错误信息

---

### **原因3: 字段名称不匹配** 🔴

数据库中可能存储的字段名称是：
- `sofaAndLoveseatDesign` (驼峰命名)
- `sofa_loveseat_design` (少了 and)
- 其他变体

**验证方法**：
```bash
php check-database-structure.php
```

脚本会搜索所有可能的字段名称变体。

---

## 🛠️ 立即执行的诊断步骤

### **步骤1: 检查数据库实际数据**

```bash
# 上传脚本
scp check-database-structure.php user@aokede.com:/home/aokede.com/public_html/wp-content/plugins/woo-walmart-sync/

# 运行脚本
ssh user@aokede.com
cd /home/aokede.com/public_html/wp-content/plugins/woo-walmart-sync
php check-database-structure.php
```

**期望输出**：

如果字段存在：
```
【检查4: 查找 sofa_and_loveseat_design 字段】
✅ 找到字段！
索引位置: 42
完整配置:
{
    "name": "sofa_and_loveseat_design",
    "type": "auto_generate",
    "source": ""
}
```

如果字段不存在：
```
【检查4: 查找 sofa_and_loveseat_design 字段】
❌ 未找到 sofa_and_loveseat_design 字段

前 20 个字段:
  [0] productName - wc_field
  [1] brand - auto_generate
  [2] shortDescription - auto_generate
  ...
```

---

### **步骤2: 根据结果采取行动**

#### **如果字段存在于数据库**

说明数据库是正确的，问题在其他地方：

1. 重新运行 `diagnose-actual-problem.php`（已修复字段名称错误）
2. 检查产品的分类是否正确
3. 检查字段映射流程

#### **如果字段不存在于数据库**

说明保存失败了，需要重新保存：

1. **清除浏览器缓存**
   - Chrome: Ctrl+Shift+Delete
   - 选择「缓存的图片和文件」
   - 点击「清除数据」

2. **重新进入分类映射页面**
   - 完全关闭浏览器
   - 重新打开并登录
   - 进入「Walmart 同步」→「分类映射」

3. **重新配置字段**
   - 找到「Sofas & Couches」分类
   - 点击「重置属性」按钮
   - **等待页面加载完成**（可能需要几秒钟）
   - 确认 `sofa_and_loveseat_design` 出现在字段列表中
   - 检查字段类型是否为「自动生成」
   - **点击「保存」按钮**
   - **等待保存成功提示**

4. **验证保存结果**
   ```bash
   php check-database-structure.php
   ```
   
   应该显示：
   ```
   ✅ 找到字段！
   ```

---

## 📊 诊断脚本对比

| 脚本名称 | 用途 | 何时使用 |
|---------|------|----------|
| `check-database-structure.php` | 检查数据库实际数据 | **首先运行** - 确认数据是否真的存在 |
| `diagnose-actual-problem.php` | 深度诊断映射流程 | 数据存在后 - 找出为什么没有生效 |
| `diagnose-sofa-design-universal.php` | 检查代码和配置 | 快速检查 - 代码是否正确 |

---

## 🎯 快速决策树

```
运行 check-database-structure.php
         ↓
    字段存在？
    ↙        ↘
  是          否
  ↓           ↓
运行          清除缓存
diagnose-     重新保存
actual-       重新验证
problem.php
```

---

## 💡 关键提示

1. **不要相信浏览器显示的内容** - 可能是缓存
2. **直接查询数据库** - 这是唯一的真相
3. **保存后要验证** - 确认数据真的写入了
4. **清除缓存很重要** - 避免看到旧数据

---

## 📞 下一步

**立即执行**：
```bash
php check-database-structure.php
```

然后根据输出结果决定下一步操作。

---

**创建时间**: 2025-10-13  
**目的**: 快速确认数据库中是否真的有字段配置

