
# ğŸ” æ ¸å¿ƒé¡µé¢æ·±åº¦åˆ†æï¼šAPIè®¾ç½® & åˆ†ç±»æ˜ å°„

## ğŸ“‹ ç›®å½•
1. [é¡µé¢æ¦‚è§ˆ](#é¡µé¢æ¦‚è§ˆ)
2. [APIè®¾ç½®é¡µé¢è¯¦è§£](#apiè®¾ç½®é¡µé¢è¯¦è§£)
3. [åˆ†ç±»æ˜ å°„é¡µé¢è¯¦è§£](#åˆ†ç±»æ˜ å°„é¡µé¢è¯¦è§£)
4. [ä¸¤é¡µé¢çš„é€»è¾‘å…³ç³»](#ä¸¤é¡µé¢çš„é€»è¾‘å…³ç³»)
5. [åŒæ­¥æµç¨‹ä¸­çš„ä½œç”¨](#åŒæ­¥æµç¨‹ä¸­çš„ä½œç”¨)
6. [æ•°æ®æµå‘å›¾](#æ•°æ®æµå‘å›¾)

---

## ğŸ“Š é¡µé¢æ¦‚è§ˆ

### ğŸ¯ ä¸¤ä¸ªé¡µé¢çš„å®šä½

| é¡µé¢ | åŠŸèƒ½å®šä½ | é…ç½®å±‚çº§ | ä½¿ç”¨é¢‘ç‡ |
|------|---------|---------|---------|
| **APIè®¾ç½®é¡µé¢** | åŸºç¡€é…ç½® | æ’ä»¶çº§åˆ« | åˆæ¬¡å®‰è£… + å¸‚åœºåˆ‡æ¢ |
| **åˆ†ç±»æ˜ å°„é¡µé¢** | ä¸šåŠ¡é…ç½® | åˆ†ç±»çº§åˆ« | æ¯ä¸ªåˆ†ç±»é¦–æ¬¡åŒæ­¥å‰ |

### ğŸ”— ä¾èµ–å…³ç³»

```
APIè®¾ç½®é¡µé¢ (åŸºç¡€å±‚)
    â†“ æä¾›APIå‡­è¯å’Œå¸‚åœºé…ç½®
åˆ†ç±»æ˜ å°„é¡µé¢ (ä¸šåŠ¡å±‚)
    â†“ æä¾›åˆ†ç±»å’Œå±æ€§æ˜ å°„è§„åˆ™
äº§å“åŒæ­¥æµç¨‹ (æ‰§è¡Œå±‚)
```

---

## ğŸ”§ APIè®¾ç½®é¡µé¢è¯¦è§£

### ğŸ“ ä½ç½®
- **å‡½æ•°**: `woo_walmart_sync_settings_page()` (è¡Œå·: 11516)
- **èœå•è·¯å¾„**: WalmartåŒæ­¥ â†’ è®¾ç½®
- **æ–‡ä»¶**: `woo-walmart-sync.php`

### ğŸ¨ é¡µé¢ç»“æ„

#### 1ï¸âƒ£ **å¤šå¸‚åœºé…ç½®åŒºåŸŸ**

```php
// æ”¯æŒ4ä¸ªå¸‚åœºçš„ç‹¬ç«‹é…ç½®
$markets = [
    'US' => ['name' => 'ç¾å›½ (US)', 'flag' => 'ğŸ‡ºğŸ‡¸'],
    'CA' => ['name' => 'åŠ æ‹¿å¤§ (CA)', 'flag' => 'ğŸ‡¨ğŸ‡¦'],
    'MX' => ['name' => 'å¢¨è¥¿å“¥ (MX)', 'flag' => 'ğŸ‡²ğŸ‡½'],
    'CL' => ['name' => 'æ™ºåˆ© (CL)', 'flag' => 'ğŸ‡¨ğŸ‡±']
];
```

**æ¯ä¸ªå¸‚åœºçš„é…ç½®é¡¹**:
- âœ… Client ID (Consumer ID)
- âœ… Client Secret (Private Key)
- âœ… Channel Type (å¯é€‰)
- âœ… å¯ç”¨/ç¦ç”¨å¼€å…³
- âœ… è¿æ¥æµ‹è¯•æŒ‰é’®

#### 2ï¸âƒ£ **ä¸»å¸‚åœºé€‰æ‹©**

```php
// æ•°æ®åº“å­—æ®µ: woo_walmart_business_unit
// å¯é€‰å€¼: WALMART_US, WALMART_CA, WALMART_MX, WALMART_CL
$business_unit = get_option('woo_walmart_business_unit', 'WALMART_US');
```

**ä½œç”¨**:
- å†³å®šé»˜è®¤ä½¿ç”¨å“ªä¸ªå¸‚åœºçš„API
- å½±å“Feedç±»å‹é€‰æ‹© (MP_ITEM vs MP_ITEM_INTL)
- å½±å“APIç«¯ç‚¹è·¯å¾„ (v3/ vs v3/ca/)

#### 3ï¸âƒ£ **é€šç”¨é…ç½®**

```php
// å¤‡è´§æ—¶é—´ (Fulfillment Lag Time)
$fulfillment_lag_time = get_option('woo_walmart_fulfillment_lag_time', 1);
// èŒƒå›´: 0-1å¤© (Walmart APIé™åˆ¶)

// å±¥è¡Œä¸­å¿ƒID (Fulfillment Center ID)
$fulfillment_center_id = get_option('woo_walmart_fulfillment_center_id', '');
// ç¤ºä¾‹: 'WFS', 'SELLER_FULFILLED', è‡ªå®šä¹‰ID
```

### ğŸ”„ å…³é”®åŠŸèƒ½å®ç°

#### ğŸ§ª **å¸‚åœºè¿æ¥æµ‹è¯•**

**AJAXå¤„ç†**: `wp_ajax_walmart_test_market_connection` (è¡Œå·: 456)

```php
// æµ‹è¯•æµç¨‹
1. æ¥æ”¶å¸‚åœºä»£ç  (US/CA/MX/CL)
2. è¯»å–è¯¥å¸‚åœºçš„Client IDå’ŒSecret
3. è°ƒç”¨ /v3/token è·å–Access Token
4. è°ƒç”¨ /v3/items?limit=1 æµ‹è¯•APIè¿æ¥
5. è¿”å›æµ‹è¯•ç»“æœ (æˆåŠŸ/å¤±è´¥ + è¯¦ç»†ä¿¡æ¯)
```

**æµ‹è¯•å‡½æ•°**: `woo_walmart_test_api_endpoint()` (è¡Œå·: 11464)

```php
function woo_walmart_test_api_endpoint($auth, $api_version) {
    // 1. æµ‹è¯•Tokenè·å–
    $token = $auth->get_access_token(true); // å¼ºåˆ¶åˆ·æ–°
    
    // 2. æµ‹è¯•Items API
    $test_result = $auth->make_request('/v3/items?limit=1');
    
    // 3. è¿”å›è¯¦ç»†ç»“æœ
    return [
        'token_success' => !empty($token),
        'api_success' => !is_wp_error($test_result),
        'details' => $test_result
    ];
}
```

#### ğŸ’¾ **é…ç½®ä¿å­˜é€»è¾‘**

```php
// ä¿å­˜æµç¨‹
if (isset($_POST['save_settings'])) {
    // 1. éªŒè¯nonce
    check_admin_referer('walmart_settings_save');
    
    // 2. ä¿å­˜æ¯ä¸ªå¸‚åœºçš„é…ç½®
    foreach ($markets as $code => $market) {
        update_option("woo_walmart_{$code}_client_id", $_POST["{$code}_client_id"]);
        update_option("woo_walmart_{$code}_client_secret", $_POST["{$code}_client_secret"]);
        update_option("woo_walmart_{$code}_enabled", isset($_POST["{$code}_enabled"]));
    }
    
    // 3. ä¿å­˜ä¸»å¸‚åœºé…ç½®
    update_option('woo_walmart_business_unit', $_POST['business_unit']);
    
    // 4. ä¿å­˜é€šç”¨é…ç½®
    update_option('woo_walmart_fulfillment_lag_time', $_POST['fulfillment_lag_time']);
    update_option('woo_walmart_fulfillment_center_id', $_POST['fulfillment_center_id']);
}
```

### ğŸ“Š æ•°æ®åº“å­˜å‚¨

| é…ç½®é¡¹ | Option Key | ç¤ºä¾‹å€¼ |
|--------|-----------|--------|
| ç¾å›½Client ID | `woo_walmart_US_client_id` | `abc123...` |
| ç¾å›½Client Secret | `woo_walmart_US_client_secret` | `xyz789...` |
| åŠ æ‹¿å¤§Client ID | `woo_walmart_CA_client_id` | `def456...` |
| ä¸»å¸‚åœº | `woo_walmart_business_unit` | `WALMART_US` |
| å¤‡è´§æ—¶é—´ | `woo_walmart_fulfillment_lag_time` | `1` |
| å±¥è¡Œä¸­å¿ƒID | `woo_walmart_fulfillment_center_id` | `WFS` |

---

## ğŸ—ºï¸ åˆ†ç±»æ˜ å°„é¡µé¢è¯¦è§£

### ğŸ“ ä½ç½®
- **å‡½æ•°**: `woo_walmart_category_mapping_page()` (è¡Œå·: 5719)
- **èœå•è·¯å¾„**: WalmartåŒæ­¥ â†’ åˆ†ç±»æ˜ å°„
- **æ–‡ä»¶**: `woo-walmart-sync.php`

### ğŸ¨ é¡µé¢ç»“æ„

#### 1ï¸âƒ£ **åˆ†ç±»æ˜ å°„åˆ—è¡¨**

**æ•°æ®æ¥æº**: `walmart_category_map` è¡¨

```sql
SELECT 
    wcm.*,
    wc.name as wc_category_name,
    COUNT(p.ID) as product_count
FROM walmart_category_map wcm
LEFT JOIN wp_terms wc ON wcm.wc_category_id = wc.term_id
LEFT JOIN wp_term_relationships tr ON wc.term_id = tr.term_taxonomy_id
LEFT JOIN wp_posts p ON tr.object_id = p.ID
WHERE p.post_type = 'product'
GROUP BY wcm.id
```

**æ˜¾ç¤ºä¿¡æ¯**:
- WooCommerceåˆ†ç±»åç§°
- Walmartåˆ†ç±»è·¯å¾„
- å·²é…ç½®å±æ€§æ•°é‡
- å…³è”äº§å“æ•°é‡
- æ“ä½œæŒ‰é’® (ç¼–è¾‘/åˆ é™¤/æ™ºèƒ½åŠ è½½)

#### 2ï¸âƒ£ **åˆ†ç±»æ˜ å°„é…ç½®ç•Œé¢**

**ä¸‰ä¸ªæ ¸å¿ƒåŒºåŸŸ**:

##### A. Walmartåˆ†ç±»é€‰æ‹©å™¨

```javascript
// å±‚çº§æ ‘å½¢é€‰æ‹©
Level 1: Home (æ ¹åˆ†ç±»)
  â†“
Level 2: Furniture (å®¶å…·)
  â†“
Level 3: Bedroom Furniture (å§å®¤å®¶å…·)
  â†“
Level 4: Bed Frames (åºŠæ¶)
```

**å®ç°æ–¹å¼**:
- ä» `walmart_categories` è¡¨è¯»å–å±‚çº§ç»“æ„
- åŠ¨æ€åŠ è½½ä¸‹çº§åˆ†ç±» (AJAX)
- æœ€ç»ˆé€‰æ‹©çš„æ˜¯æœ€åº•å±‚åˆ†ç±»ID

##### B. å±æ€§æ˜ å°„é…ç½®å™¨

**æ•°æ®ç»“æ„**:
```javascript
{
    "name": ["brand", "color", "material"],      // å±æ€§åç§°æ•°ç»„
    "type": ["attribute", "auto", "attribute"],  // æ•°æ®æ¥æºç±»å‹
    "source": ["Brand", "", "Material"]          // WooCommerceå±æ€§å
}
```

**ä¸‰ç§æ•°æ®æ¥æºç±»å‹**:

1. **`attribute`** - ä»WooCommerceäº§å“å±æ€§è·å–
   ```php
   $value = $product->get_attribute($source); // $source = "Brand"
   ```

2. **`auto`** - è‡ªåŠ¨ç”Ÿæˆ (é€šè¿‡äº§å“æ˜ å°„å™¨)
   ```php
   $value = $mapper->generate_special_attribute_value($field_name, $product);
   ```

3. **`fixed`** - å›ºå®šå€¼
   ```php
   $value = $source; // ç›´æ¥ä½¿ç”¨é…ç½®çš„å€¼
   ```

##### C. å±æ€§å­—æ®µç®¡ç†

**å­—æ®µåˆ†ç»„æ˜¾ç¤º**:
```
ğŸ“¦ Orderable (å½±å“è®¢è´­)
  - SKU âœ… å¿…å¡«
  - Price âœ… å¿…å¡«
  - Brand âœ… å¿…å¡«
  
ğŸ‘ï¸ Visible (äº§å“å±•ç¤º)
  - Product Name âœ… å¿…å¡«
  - Main Image URL âœ… å¿…å¡«
  - Short Description
  - Key Features
  - Color
  - Material
  ...
```

### ğŸ”„ å…³é”®åŠŸèƒ½å®ç°

#### 1ï¸âƒ£ **è·å–Walmartåˆ†ç±»æ ‘**

**AJAX**: `wp_ajax_get_walmart_category_tree` (è¡Œå·: 21144)

```php
function handle_get_walmart_category_tree() {
    $wc_cat_id = $_POST['wc_cat_id'];
    
    // 1. æŸ¥è¯¢Walmartåˆ†ç±»å±‚çº§ç»“æ„
    $categories = $wpdb->get_results("
        SELECT category_id, category_name, parent_id, level
        FROM {$wpdb->prefix}walmart_categories
        WHERE level = 1
        ORDER BY category_name
    ");
    
    // 2. æ„å»ºæ ‘å½¢ç»“æ„
    $tree = build_category_tree($categories);
    
    // 3. è¿”å›JSON
    wp_send_json_success(['tree' => $tree]);
}
```

#### 2ï¸âƒ£ **è·å–åˆ†ç±»å±æ€§å®šä¹‰**

**AJAX**: `wp_ajax_get_walmart_category_attributes` (è¡Œå·: 13248)

```php
function handle_get_category_attributes() {
    $category_id = $_POST['category_id'];
    
    // 1. ä»æ•°æ®åº“è¯»å–å±æ€§å®šä¹‰
    $attributes = $wpdb->get_results($wpdb->prepare("
        SELECT 
            attribute_name,
            attribute_type,
            is_required,
            allowed_values,
            attribute_group,
            description
        FROM {$wpdb->prefix}walmart_product_attributes
        WHERE product_type_id = %s
        ORDER BY display_order, attribute_name
    ", $category_id));
    
    // 2. å¦‚æœæ•°æ®åº“ä¸ºç©ºï¼Œä»APIè·å–
    if (empty($attributes)) {
        $attributes = fetch_from_walmart_api($category_id);
        save_attributes_to_database($attributes, $category_id);
    }
    
    // 3. è¿”å›å±æ€§åˆ—è¡¨
    wp_send_json_success(['attributes' => $attributes]);
}
```

#### 3ï¸âƒ£ **ä¿å­˜åˆ†ç±»æ˜ å°„**

**AJAX**: `wp_ajax_save_category_mapping` (è¡Œå·: 21470)

```php
function handle_save_category_mapping() {
    // 1. æ¥æ”¶æ•°æ®
    $wc_category_id = $_POST['wc_category_id'];
    $walmart_category_path = $_POST['walmart_category_path'];
    $attributes = json_decode($_POST['walmart_attributes'], true);
    
    // 2. éªŒè¯æ•°æ®
    if (empty($wc_category_id) || empty($walmart_category_path)) {
        wp_send_json_error(['message' => 'åˆ†ç±»IDå’Œè·¯å¾„ä¸èƒ½ä¸ºç©º']);
    }
    
    // 3. ä¿å­˜åˆ°æ•°æ®åº“
    $wpdb->replace(
        $wpdb->prefix . 'walmart_category_map',
        [
            'wc_category_id' => $wc_category_id,
            'wc_category_name' => get_term($wc_category_id)->name,
            'walmart_category_path' => $walmart_category_path,
            'walmart_attributes' => json_encode($attributes),
            'updated_at' => current_time('mysql')
        ]
    );
    
    // 4. è¿”å›æˆåŠŸ
    wp_send_json_success(['message' => 'æ˜ å°„ä¿å­˜æˆåŠŸ']);
}
```

#### 4ï¸âƒ£ **æ™ºèƒ½åŠ è½½å±æ€§**

**åŠŸèƒ½**: è‡ªåŠ¨ä»Walmart APIè·å–åˆ†ç±»çš„å±æ€§å®šä¹‰

```php
// æµç¨‹
1. ç”¨æˆ·ç‚¹å‡»"æ™ºèƒ½åŠ è½½"æŒ‰é’®
   â†“
2. è°ƒç”¨ Walmart Spec API
   GET /v3/items/taxonomy/{categoryId}/attributes
   â†“
3. è§£æAPIå“åº” (JSON Schemaæ ¼å¼)
   - æå–å­—æ®µåç§°
   - æå–å­—æ®µç±»å‹ (string/number/array/object)
   - æå–å¿…å¡«æ€§ (required)
   - æå–æšä¸¾å€¼ (enum)
   - æå–éªŒè¯è§„åˆ™ (pattern/min/max)
   â†“
4. ä¿å­˜åˆ° walmart_product_attributes è¡¨
   â†“
5. åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºå±æ€§åˆ—è¡¨
```

#### 5ï¸âƒ£ **é‡ç½®å±æ€§**

**AJAX**: `wp_ajax_clear_category_attributes` (è¡Œå·: 13128)

```php
function handle_clear_category_attributes() {
    $category_id = $_POST['category_id'];
    
    // 1. åˆ é™¤æ•°æ®åº“ä¸­çš„å±æ€§å®šä¹‰
    $wpdb->delete(
        $wpdb->prefix . 'walmart_product_attributes',
        ['product_type_id' => $category_id]
    );
    
    // 2. æ¸…é™¤ç¼“å­˜
    delete_transient("walmart_attributes_{$category_id}");
    
    // 3. è¿”å›æˆåŠŸ
    wp_send_json_success(['message' => 'å±æ€§å·²é‡ç½®']);
}
```

### ğŸ“Š æ•°æ®åº“å­˜å‚¨

#### `walmart_category_map` è¡¨ç»“æ„

```sql
CREATE TABLE walmart_category_map (
    id INT AUTO_INCREMENT PRIMARY KEY,
    wc_category_id BIGINT NOT NULL,           -- WooCommerceåˆ†ç±»ID
    wc_category_name VARCHAR(255),            -- WooCommerceåˆ†ç±»åç§°
    walmart_category_path VARCHAR(500),       -- Walmartåˆ†ç±»è·¯å¾„
    walmart_attributes LONGTEXT,              -- å±æ€§æ˜ å°„è§„åˆ™ (JSON)
    market VARCHAR(10) DEFAULT 'US',          -- å¸‚åœºä»£ç 
    created_at DATETIME,
    updated_at DATETIME,
    UNIQUE KEY (wc_category_id, market)
);
```

#### `walmart_attributes` JSONç»“æ„

```json
{
    "name": [
        "brand",
        "color", 
        "material",
        "assembledProductHeight",
        "assembledProductWidth"
    ],
    "type": [
        "attribute",
        "auto",
        "attribute",
        "auto",
        "auto"
    ],
    "source": [
        "Brand",
        "",
        "Material",
        "",
        ""
    ]
}
```

---

## ğŸ”— ä¸¤é¡µé¢çš„é€»è¾‘å…³ç³»

### ğŸ“Š é…ç½®å±‚çº§å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   APIè®¾ç½®é¡µé¢ (åŸºç¡€é…ç½®å±‚)           â”‚
â”‚   - é…ç½®APIå‡­è¯                      â”‚
â”‚   - é€‰æ‹©ä¸»å¸‚åœº                       â”‚
â”‚   - è®¾ç½®é€šç”¨å‚æ•°                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ æä¾›APIè®¿é—®èƒ½åŠ›
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åˆ†ç±»æ˜ å°„é¡µé¢ (ä¸šåŠ¡é…ç½®å±‚)          â”‚
â”‚   - æ˜ å°„WCåˆ†ç±»åˆ°Walmartåˆ†ç±»          â”‚
â”‚   - é…ç½®å±æ€§æ˜ å°„è§„åˆ™                 â”‚
â”‚   - è·å–åˆ†ç±»å±æ€§å®šä¹‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ æä¾›æ˜ å°„è§„åˆ™
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº§å“åŒæ­¥æµç¨‹ (æ‰§è¡Œå±‚)              â”‚
â”‚   - è¯»å–APIé…ç½®                      â”‚
â”‚   - è¯»å–æ˜ å°„è§„åˆ™                     â”‚
â”‚   - æ‰§è¡Œäº§å“åŒæ­¥                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ æ•°æ®æµå‘

#### é…ç½®é˜¶æ®µ

```
ç”¨æˆ· â†’ APIè®¾ç½®é¡µé¢ â†’ wp_optionsè¡¨
                    â”œâ”€ woo_walmart_US_client_id
                    â”œâ”€ woo_walmart_US_client_secret
                    â”œâ”€ woo_walmart_business_unit
                    â””â”€ woo_walmart_fulfillment_lag_time

ç”¨æˆ· â†’ åˆ†ç±»æ˜ å°„é¡µé¢ â†’ walmart_category_mapè¡¨
                     â”œâ”€ wc_category_id
                     â”œâ”€ walmart_category_path
                     â””â”€ walmart_attributes (JSON)
```

#### åŒæ­¥é˜¶æ®µ

```
äº§å“åŒæ­¥è¯·æ±‚
    â†“
1. è¯»å–APIé…ç½® (ä»wp_options)
    â”œâ”€ è·å–Client ID/Secret
    â”œâ”€ ç¡®å®šä¸»å¸‚åœº
    â””â”€ è·å–é€šç”¨å‚æ•°
    â†“
2. è¯»å–åˆ†ç±»æ˜ å°„ (ä»walmart_category_map)
    â”œâ”€ æ ¹æ®äº§å“åˆ†ç±»IDæŸ¥è¯¢
    â”œâ”€ è·å–Walmartåˆ†ç±»è·¯å¾„
    â””â”€ è·å–å±æ€§æ˜ å°„è§„åˆ™
    â†“
3. æ‰§è¡Œäº§å“æ˜ å°„ (class-product-mapper.php)
    â”œâ”€ æ ¹æ®æ˜ å°„è§„åˆ™æå–å±æ€§å€¼
    â”œâ”€ è‡ªåŠ¨ç”Ÿæˆå¿…å¡«å­—æ®µ
    â””â”€ æ„å»ºWalmart APIæ•°æ®æ ¼å¼
    â†“
4. è°ƒç”¨Walmart API (class-api-key-auth.php)
    â”œâ”€ ä½¿ç”¨é…ç½®çš„å‡­è¯è·å–Token
    â”œâ”€ æäº¤Feedåˆ°å¯¹åº”å¸‚åœº
    â””â”€ è¿”å›Feed ID
```

### ğŸ¯ ä¾èµ–å…³ç³»

| é¡µé¢ | ä¾èµ–é¡¹ | è¢«ä¾èµ–é¡¹ |
|------|--------|---------|
| **APIè®¾ç½®** | æ—  | åˆ†ç±»æ˜ å°„ã€äº§å“åŒæ­¥ |
| **åˆ†ç±»æ˜ å°„** | APIè®¾ç½® (éœ€è¦APIå‡­è¯è·å–åˆ†ç±») | äº§å“åŒæ­¥ |

**å…³é”®ç‚¹**:
1. âœ… **å¿…é¡»å…ˆé…ç½®APIè®¾ç½®** - å¦åˆ™æ— æ³•è·å–Walmartåˆ†ç±»åˆ—è¡¨
2. âœ… **å¿…é¡»å…ˆé…ç½®åˆ†ç±»æ˜ å°„** - å¦åˆ™äº§å“åŒæ­¥æ—¶æ‰¾ä¸åˆ°æ˜ å°„è§„åˆ™
3. âš ï¸ **å¸‚åœºåˆ‡æ¢å½±å“** - åˆ‡æ¢ä¸»å¸‚åœºåï¼Œéœ€è¦é‡æ–°é…ç½®åˆ†ç±»æ˜ å°„

---

## ğŸš€ åŒæ­¥æµç¨‹ä¸­çš„ä½œç”¨

### ğŸ“‹ å®Œæ•´åŒæ­¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: ç”¨æˆ·è§¦å‘åŒæ­¥                                      â”‚
â”‚ - äº§å“åˆ—è¡¨é¡µç‚¹å‡»"åŒæ­¥åˆ°Walmart"                          â”‚
â”‚ - æˆ–æ‰¹é‡æ“ä½œé€‰æ‹©å¤šä¸ªäº§å“                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: è¯»å–APIé…ç½® (APIè®¾ç½®é¡µé¢çš„ä½œç”¨)                   â”‚
â”‚                                                          â”‚
â”‚ class-api-key-auth.php::__construct()                   â”‚
â”‚ {                                                        â”‚
â”‚     // 1. è·å–ä¸»å¸‚åœºé…ç½®                                 â”‚
â”‚     $business_unit = get_option('woo_walmart_business_unit');â”‚
â”‚     $market_code = str_replace('WALMART_', '', $business_unit);â”‚
â”‚                                                          â”‚
â”‚     // 2. è¯»å–è¯¥å¸‚åœºçš„APIå‡­è¯                            â”‚
â”‚     $this->client_id = get_option("woo_walmart_{$market_code}_client_id");â”‚
â”‚     $this->client_secret = get_option("woo_walmart_{$market_code}_client_secret");â”‚
â”‚                                                          â”‚
â”‚     // 3. è·å–é€šç”¨é…ç½®                                   â”‚
â”‚     $fulfillment_lag_time = get_option('woo_walmart_fulfillment_lag_time');â”‚
â”‚     $fulfillment_center_id = get_option('woo_walmart_fulfillment_center_id');â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤3: è¯»å–åˆ†ç±»æ˜ å°„ (åˆ†ç±»æ˜ å°„é¡µé¢çš„ä½œç”¨)                 â”‚
â”‚                                                          â”‚
â”‚ class-product-sync.php::initiate_sync()                 â”‚
â”‚ {                                                        â”‚
â”‚     // 1. è·å–äº§å“çš„WooCommerceåˆ†ç±»                      â”‚
â”‚     $product_cat_ids = $product->get_category_ids();    â”‚
â”‚                                                          â”‚
â”‚     // 2. æŸ¥è¯¢åˆ†ç±»æ˜ å°„                                   â”‚
â”‚     $mapped_category_data = $wpdb->get_row("            â”‚
â”‚         SELECT walmart_category_path, walmart_attributesâ”‚
â”‚         FROM walmart_category_map                        â”‚
â”‚         WHERE wc_category_id = {$cat_id}                â”‚
â”‚     ");                                                  â”‚
â”‚                                                          â”‚
â”‚     // 3. è§£æå±æ€§æ˜ å°„è§„åˆ™                               â”‚
â”‚     $attribute_rules = json_decode(                     â”‚
â”‚         $mapped_category_data->walmart_attributes, true â”‚
â”‚     );                                                   â”‚
â”‚     // ç»“æ„: {name: [], type: [], source: []}           â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤4: æ‰§è¡Œäº§å“æ˜ å°„                                      â”‚
â”‚                                                          â”‚
â”‚ class-product-mapper.php::map()                         â”‚
â”‚ {                                                        â”‚
â”‚     // ä½¿ç”¨åˆ†ç±»æ˜ å°„è§„åˆ™æå–å±æ€§å€¼                         â”‚
â”‚     foreach ($attribute_rules['name'] as $index => $field_name) {â”‚
â”‚         $type = $attribute_rules['type'][$index];       â”‚
â”‚         $source = $attribute_rules['source'][$index];   â”‚
â”‚                                                          â”‚
â”‚         if ($type === 'attribute') {                    â”‚
â”‚             // ä»WooCommerceå±æ€§è·å–                     â”‚
â”‚             $value = $product->get_attribute($source);  â”‚
â”‚         } elseif ($type === 'auto') {                   â”‚
â”‚             // è‡ªåŠ¨ç”Ÿæˆ                                  â”‚
â”‚             $value = $this->generate_special_attribute_value($field_name, $product);â”‚
â”‚         } elseif ($type === 'fixed') {                  â”‚
â”‚             // ä½¿ç”¨å›ºå®šå€¼                                â”‚
â”‚             $value = $source;                           â”‚
â”‚         }                                                â”‚
â”‚                                                          â”‚
â”‚         $walmart_data[$field_name] = $value;            â”‚
â”‚     }                                                    â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤5: è°ƒç”¨Walmart API                                   â”‚
â”‚                                                          â”‚
â”‚ class-api-key-auth.php::make_file_upload_request()     â”‚
â”‚ {                                                        â”‚
â”‚     // 1. ä½¿ç”¨é…ç½®çš„å‡­è¯è·å–Token                        â”‚
â”‚     $access_token = $this->get_access_token();          â”‚
â”‚                                                          â”‚
â”‚     // 2. æ ¹æ®å¸‚åœºé€‰æ‹©Feedç±»å‹                           â”‚
â”‚     $feed_type = ($market_code === 'US')                â”‚
â”‚         ? 'MP_ITEM'                                      â”‚
â”‚         : 'MP_ITEM_INTL';                                â”‚
â”‚                                                          â”‚
â”‚     // 3. æäº¤Feed                                       â”‚
â”‚     $response = wp_remote_post(                         â”‚
â”‚         "https://marketplace.walmartapis.com/v3/feeds?feedType={$feed_type}",â”‚
â”‚         [                                                â”‚
â”‚             'headers' => [                               â”‚
â”‚                 'WM_SEC.ACCESS_TOKEN' => $access_token, â”‚
â”‚                 'WM_MARKET' => $market_code              â”‚
â”‚             ],                                           â”‚
â”‚             'body' => $walmart_data                      â”‚
â”‚         ]                                                â”‚
â”‚     );                                                   â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ ä¸¤é¡µé¢åœ¨åŒæ­¥ä¸­çš„å…·ä½“ä½œç”¨

#### APIè®¾ç½®é¡µé¢çš„ä½œç”¨

| é…ç½®é¡¹ | åœ¨åŒæ­¥ä¸­çš„ä½¿ç”¨ | å½±å“èŒƒå›´ |
|--------|---------------|---------|
| **Client ID/Secret** | è·å–Access Token | æ‰€æœ‰APIè°ƒç”¨ |
| **ä¸»å¸‚åœº** | å†³å®šAPIç«¯ç‚¹å’ŒFeedç±»å‹ | Feedæäº¤ã€æ•°æ®æ ¼å¼ |
| **å¤‡è´§æ—¶é—´** | å¡«å……`fulfillmentLagTime`å­—æ®µ | äº§å“æ•°æ® |
| **å±¥è¡Œä¸­å¿ƒID** | å¡«å……`shipNode`å­—æ®µ | äº§å“æ•°æ® |

**ä»£ç ç¤ºä¾‹**:
```php
// åœ¨äº§å“æ˜ å°„æ—¶ä½¿ç”¨APIè®¾ç½®
$walmart_data = [
    'MPItemFeedHeader' => [
        'businessUnit' => get_option('woo_walmart_business_unit'), // ä»APIè®¾ç½®è¯»å–
        'locale' => 'en'
    ],
    'MPItem' => [
        [
            'Orderable' => [
                'fulfillmentLagTime' => get_option('woo_walmart_fulfillment_lag_time'), // ä»APIè®¾ç½®è¯»å–
                'shipNode' => get_option('woo_walmart_fulfillment_center_id') // ä»APIè®¾ç½®è¯»å–
            ]
        ]
    ]
];
```

#### åˆ†ç±»æ˜ å°„é¡µé¢çš„ä½œç”¨

| é…ç½®é¡¹ | åœ¨åŒæ­¥ä¸­çš„ä½¿ç”¨ | å½±å“èŒƒå›´ |
|--------|---------------|---------|
| **Walmartåˆ†ç±»è·¯å¾„** | ç¡®å®šäº§å“çš„åˆ†ç±»å½’å± | åˆ†ç±»ç‰¹å®šçš„å±æ€§è¦æ±‚ |
| **å±æ€§æ˜ å°„è§„åˆ™** | æŒ‡å¯¼å±æ€§å€¼æå– | æ‰€æœ‰äº§å“å­—æ®µ |
| **å±æ€§å®šä¹‰** | éªŒè¯å’Œè½¬æ¢æ•°æ®ç±»å‹ | æ•°æ®æ ¼å¼æ­£ç¡®æ€§ |

**ä»£ç ç¤ºä¾‹**:
```php
// åœ¨äº§å“æ˜ å°„æ—¶ä½¿ç”¨åˆ†ç±»æ˜ å°„
$attribute_rules = json_decode($mapped_category_data->walmart_attributes, true);

foreach ($attribute_rules['name'] as $index => $field_name) {
    $type = $attribute_rules['type'][$index];
    $source = $attribute_rules['source'][$index];
    
    // æ ¹æ®æ˜ å°„è§„åˆ™æå–å€¼
    if ($type === 'attribute') {
        $value = $product->get_attribute($source);
    } elseif ($type === 'auto') {
        $value = $this->generate_special_attribute_value($field_name, $product);
    }
    
    // ä½¿ç”¨å±æ€§å®šä¹‰éªŒè¯å’Œè½¬æ¢
    $spec = $spec_service->get_field_spec($walmart_category_path, $field_name);
    $validated = $spec_service->validate_field_value($walmart_category_path, $field_name, $value);
    
    $walmart_data['MPItem'][0]['Visible'][$walmart_category_name][$field_name] = $validated['corrected_value'];
}
```

---

## ğŸ“Š æ•°æ®æµå‘å›¾

### å®Œæ•´æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é…ç½®é˜¶æ®µ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·é…ç½®APIè®¾ç½®
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   wp_optionsè¡¨      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ woo_walmart_US_     â”‚
â”‚   client_id         â”‚
â”‚ woo_walmart_US_     â”‚
â”‚   client_secret     â”‚
â”‚ woo_walmart_        â”‚
â”‚   business_unit     â”‚
â”‚ woo_walmart_        â”‚
â”‚   fulfillment_      â”‚
â”‚   lag_time          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (APIå‡­è¯å¯ç”¨)
ç”¨æˆ·é…ç½®åˆ†ç±»æ˜ å°„
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   walmart_category_mapè¡¨     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ wc_category_id              â”‚
â”‚ walmart_category_